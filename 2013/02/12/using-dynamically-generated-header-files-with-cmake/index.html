<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Using Dynamically Generated Header Files with CMake</title>
  <meta name="description" content="Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting CMake to re">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="Using Dynamically Generated Header Files with CMake">
  <meta name="twitter:description" content="Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting CMake to re">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Using Dynamically Generated Header Files with CMake">
  <meta property="og:description" content="Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting CMake to re">
  <meta property="og:url" content="http://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/prism.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/extra.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="http://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="http://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

  <script src="/js/jquery-3.3.1.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/prism.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "http://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
         google_ad_client: "ca-pub-1613732348909658",
         enable_page_level_ads: true
    });
  </script>
</head>
  <body>
    <nav class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">TechTinkering</a>
    </div>

    <div id="navbar" class="collapse navbar-collapse navbar-right">
      <ul class="nav navbar-nav navbar-right contact-buttons">
        <li>
          <!-- From: http://www.buttonshut.com/Get-Button-Huts-Code/Twitter-Buttons-1124.html -->
          <a href="http://twitter.com/TechTinkering" title="@TechTinkering on Twitter">
            <img class="bannerIcon" src="/images/twitter-button-36.png" alt="@techtinkering on Twitter"/>
          </a>
        </li>
        <li>
          <!-- From: http://www.buttonshut.com/Get-Button-Huts-Code/Youtube-Buttons-831.html -->
          <a href="http://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">
            <img class="bannerIcon" src="/images/youtube-small-square-32.png" alt="YouTube Channel"/>
          </a>
        </li>
        <li>
          <!-- From: http://www.graphicsfuel.com/2011/05/email-icon-psd/ -->
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">
            <img class="bannerIcon" src="/images/email.png" alt="Email"/>
          </a>
        </li>
        <li>
          <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On Github ">
            <img class="bannerIcon" src="/images/octocat_fluid.png" alt="Techtinkering Repo on  Github"/>
          </a>
        </li>
        <li>
          <a href="http://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">
            <img class="bannerIcon" src="/images/feed-icon-28x28.png" alt="RSS Feed"/>
          </a>
        </li>
      </ul>

    </div><!--/.nav-collapse -->
  </div>
</nav>
    <div id="content" class="container">
      <div class="row margin-buffer">
  <div class="col-md-12">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2013/02/12/using-dynamically-generated-header-files-with-cmake/" title="Using Dynamically Generated Header Files with CMake">
          <h1 itemprop="headline name">Using Dynamically Generated Header Files with CMake</h1>
        </a>
        <div class="pull-right">
          <ul class="share-buttons">
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Ftechtinkering.com&text=:%20http%3A%2F%2Ftechtinkering.com&via=TechTinkering" target="_blank" title="Tweet" onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;"><img alt="Tweet" src="/img/social_flat_rounded_rects_svg/Twitter.svg" /></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Ftechtinkering.com&title=" target="_blank" title="Submit to Reddit" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&title=' +  encodeURIComponent(document.title)); return false;"><img alt="Submit to Reddit" src="/img/social_flat_rounded_rects_svg/Reddit.svg" /></a></li>
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Ftechtinkering.com&quote=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&quote=' + encodeURIComponent(document.URL)); return false;"><img alt="Share on Facebook" src="/img/social_flat_rounded_rects_svg/Facebook.svg" /></a></li>
  <li><a href="mailto:?subject=&body=:%20http%3A%2F%2Ftechtinkering.com" target="_blank" title="Send email" onclick="window.open('mailto:?subject=' + encodeURIComponent(document.title) + '&body=' +  encodeURIComponent(document.URL)); return false;"><img alt="Send email" src="/img/social_flat_rounded_rects_svg/Email.svg" /></a></li>
</ul>
        </div>
          <time itemprop="datePublished"
                datetime="2013-02-12">
            12 February 2013
          </time>
          &nbsp; / &nbsp;
        <span itemscope itemprop="publisher"
              itemtype="http://schema.org/Organization">
          <meta itemprop="name" content="TechTinkering" />
          <meta itemprop="url" content="http://techtinkering.com" />
        </span>
        <span itemscope itemprop="author" itemtype="http://schema.org/Person">
          <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
            <span itemprop="name">Lawrence Woodman</span>
          </a>
        </span>
        &nbsp; / &nbsp;
          <a href="/articles/tag/programming/">Programming</a>
          &nbsp; &nbsp;
          <a href="/articles/tag/tutorial/">Tutorial</a>
          &nbsp; &nbsp;
      </header>
      <br />
      <div itemprop="articleBody">
        <p>Sometimes it can be useful to dynamically generate header files and include them from a C source file.  However, it can be a little difficult getting <a href="http://www.cmake.org">CMake</a> to recognize when to generate the files and when to recompile the source files that include those headers.  What follows is a method to do this.</p>
<h2>Telling CMake to Generate the Header File</h2>
<p>To generate the header file we need to create a <em>custom_command</em> which will run the command to generate the header file, when the file it is based on has changed. The following shows how to use the hypothetical <code>generatewordlistheader</code> command to create <code>wordlist.h</code> everytime <code>wordlist.txt</code> changes.</p>
<pre><code class="language-text">add_custom_command(
    PRE_BUILD
    OUTPUT wordlist.h
    COMMAND generatewordlistheader wordlist.txt wordlist.h
    DEPENDS wordlist.txt
)
</code></pre>
<h2>Telling CMake When to Recompile</h2>
<p>Next we need to tell CMake to recompile any source files which include the generated header file, when the header file has changed.  To do this we create a statically linked library, here called <code>poet</code>, that relies on the source files that include the header and the header itself.</p>
<pre><code class="language-text">add_library(poet STATIC poet.c ${MyApp_SOURCE_DIR}/src/wordlist.h)
</code></pre>
<p>Finally we need to ensure that the statically generated library above is linked into the application.</p>
<pre><code class="language-text">target_link_libraries(myapp poet)
</code></pre>
<h2>Full example</h2>
<p>Using a fictional project called <em>MyApp</em> we can see how this is put together.</p>
<pre><code class="language-text">cmake_minimum_required(VERSION 2.6)
project(MyApp)
add_executable(myapp myapp.c)

add_custom_command(
    PRE_BUILD
    OUTPUT wordlist.h
    COMMAND generatewordlistheader wordlist.txt wordlist.h
    DEPENDS wordlist.txt
)

add_library(poet STATIC poet.c ${MyApp_SOURCE_DIR}/src/wordlist.h)

target_link_libraries(myapp poet)
</code></pre>
<h2>Conclusion</h2>
<p>This isn't perfect but it does work.  Unfortunately CMake is an ugly, but very useful tool.  I'm sure there is a better way to do this and if anyone can think of a way, please leave a comment or email me.  Until then, this achieves what I and a number of other people have been trying to do.</p>
      </div>
    </article>
  </div>
</div>

  <div class="row">
    <div class="col-md-12">
      <div id="cclicence">
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
          <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
        </a>
        <br />
        <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Using Dynamically Generated Header Files with CMake</span>
        by <a xmlns:cc="http://creativecommons.org/ns#" href="http://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
       is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>
  </div>

    <div class="row">
      <div class="col-md-12">
        <h2>Related Articles</h2>
      </div>
    </div>
    <div class="row margin-buffer">
  <div class="col-md-12">
        <header>
  <h3><a href="/2013/05/10/adding-a-basic-stub-to-a-vic-20-assembly-language-program/">Adding a Basic Stub to a Vic-20 Assembly Language Program</a></h3>
  <span class="post-meta">
      <time datetime="2013-05-10">
        10 May 2013
      </time>
      &nbsp; / &nbsp;
      <a href="/articles/tag/assembly/">Assembly</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/commodore/">Commodore</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/programming/">Programming</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/retro/">Retro</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tutorial/">Tutorial</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/vic-20/">Vic-20</a>
      &nbsp; &nbsp;
  </span>
</header>
<div>
  To make machine language programs more friendly it is nice to add a basic stub which contains a line with a SYS statement to start the code.  This is easy to do on the Vic-20 and the process gives you ...
  &nbsp;
  <a class="readMore" href="/2013/05/10/adding-a-basic-stub-to-a-vic-20-assembly-language-program/">Read More</a>
</div>
        <header>
  <h3><a href="/2013/04/16/beginning-assembly-programming-on-the-commodore-vic-20/">Beginning Assembly Programming on the Commodore Vic-20</a></h3>
  <span class="post-meta">
      <time datetime="2013-04-16">
        16 April 2013
      </time>
      &nbsp; / &nbsp;
      <a href="/articles/tag/assembly/">Assembly</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/commodore/">Commodore</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/programming/">Programming</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/retro/">Retro</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tutorial/">Tutorial</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/vic-20/">Vic-20</a>
      &nbsp; &nbsp;
  </span>
</header>
<div>
  The Commodore Vic-20 is a great machine to learn an assembly language on.  It was released in 1981 and was the first computer to sell one million units, which contributes to its popularity today.  The ...
  &nbsp;
  <a class="readMore" href="/2013/04/16/beginning-assembly-programming-on-the-commodore-vic-20/">Read More</a>
</div>
        <header>
  <h3><a href="/2013/02/20/compiling-a-tcl-script-into-an-executable/">Compiling a Tcl Script into an Executable</a></h3>
  <span class="post-meta">
      <time datetime="2013-02-20">
        20 February 2013
      </time>
      &nbsp; / &nbsp;
      <a href="/articles/tag/c/">C</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/programming/">Programming</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tcl/">Tcl</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tutorial/">Tutorial</a>
      &nbsp; &nbsp;
  </span>
</header>
<div>
  Locating Tcl scripts to load from an executable can be awkward if you want to make your program cross-platform.  An easier way is to compile a Tcl script directly into the executable and let that scrip...
  &nbsp;
  <a class="readMore" href="/2013/02/20/compiling-a-tcl-script-into-an-executable/">Read More</a>
</div>
        <header>
  <h3><a href="/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/">Embedding an SDL Surface in a Tk Window</a></h3>
  <span class="post-meta">
      <time datetime="2012-06-26">
        26 June 2012
      </time>
      &nbsp; / &nbsp;
      <a href="/articles/tag/programming/">Programming</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/sdl/">SDL</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tcl/">Tcl</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tk/">Tk</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tutorial/">Tutorial</a>
      &nbsp; &nbsp;
  </span>
</header>
<div>
  Tk is great, but sometimes it just isn't fast enough.  SDL is fast, but has no support for input dialogs and other GUI conventions.  By embedding an SDL surface in a Tk window you get the best of both ...
  &nbsp;
  <a class="readMore" href="/2012/06/26/embedding-an-sdl-surface-in-a-tk-window/">Read More</a>
</div>
        <header>
  <h3><a href="/2009/07/14/running-4k-fortran-on-a-dec-pdp8/">Running 4K FORTRAN on a DEC PDP-8</a></h3>
  <span class="post-meta">
      <time datetime="2009-07-14">
        14 July 2009
      </time>
      &nbsp; / &nbsp;
      <a href="/articles/tag/dec/">DEC</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/fortran/">FORTRAN</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/pdp-8/">PDP-8</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/programming/">Programming</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/retro/">Retro</a>
      &nbsp; &nbsp;
      <a href="/articles/tag/tutorial/">Tutorial</a>
      &nbsp; &nbsp;
  </span>
</header>
<div>
  4K FORTRAN was a subset of FORTRAN II and was the first high-level language available for the DEC PDP-8.  It consisted of two parts: the 4K FORTRAN Compiler (nicknamed &quot;Fivetran&quot;) and the 4K ...
  &nbsp;
  <a class="readMore" href="/2009/07/14/running-4k-fortran-on-a-dec-pdp8/">Read More</a>
</div>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <form id="email-subscribe" action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=TechTinkering', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
  <p>Sign up to get new articles straight to your inbox.</p>
  <p><input type="text" style="width:180px" name="email" placeholder="Email address"/>
  <input type="hidden" value="TechTinkering" name="uri"/>
  <input type="hidden" name="loc" value="en_US"/>
  <input class="subscribe-button" type="submit" value="Subscribe" /></p>
  <p>Delivered by <a href="https://feedburner.google.com" target="_blank">FeedBurner</a></p>
</form>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'techtinkering';
      var disqus_identifier = '/2013/02/12/using-dynamically-generated-header-files-with-cmake/';
      var disqus_url = 'http://techtinkering.com/2013/02/12/using-dynamically-generated-header-files-with-cmake/';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>
    </div>

    <footer>
  <nav class="navbar navbar-default">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <strong>Legal:</strong> &nbsp;
          <a href="/terms/">T & C</a>, &nbsp; &nbsp;
          <a href="/privacy/">Privacy Policy</a>
        </div>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>