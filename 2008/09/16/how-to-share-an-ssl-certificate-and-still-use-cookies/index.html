<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>How to share an SSL certificate and still use cookies</title>
  <meta name="description" content="Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses cooki">
  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <!-- *** Twitter Card *** -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@techtinkering">
  <meta name="twitter:title" content="How to share an SSL certificate and still use cookies">
  <meta name="twitter:description" content="Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses cooki">
  <!-- *** Twitter Card *** -->

  <!-- *** Open Graph *** --->
  <meta property="og:type" content="website">
  <meta property="og:title" content="How to share an SSL certificate and still use cookies">
  <meta property="og:description" content="Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses cooki">
  <meta property="og:url" content="https://techtinkering.com/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/">
  <!-- *** Open Graph *** --->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4388762-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-4388762-2');
  </script>

  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/article.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" rel="stylesheet" type="text/css" />
  <link rel="canonical" href="https://techtinkering.com/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/">
  <link rel="alternate" type="application/rss+xml" title="TechTinkering - Retro Computers, Programming, General Technical Tinkering"
        href="https://feedproxy.google.com/TechTinkering" />

	<!-- ****** faviconit.com favicons ****** -->
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<!-- ****** faviconit.com favicons ****** -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    // Cookie Consent - https://cookieconsent.insites.com
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#252e39"
        },
        "button": {
          "background": "#14a7d0"
        }
      },
      "theme": "classic",
      "position": "top",
      "static": true,
      "content": {
        "message": "TechTinkering uses cookies for advertising, analytics, etc.",
        "href": "https://techtinkering.com/privacy/"
      }
    })});
  </script>

  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
         google_ad_client: "ca-pub-1613732348909658",
         enable_page_level_ads: true
    });
  </script>
</head>
  <body>
    <nav>
  <div class="container">
    <div class="navbar-header">
      <a href="/">TechTinkering</a><br />
      =============
    </div>

    <div class="contact">
      <ul>
        <li>
          <a href="https://twitter.com/TechTinkering" title="@TechTinkering on Twitter">Twitter</a>
        </li>
        <li>
          <a href="https://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">YouTube</a>
        </li>
        <li>
          <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">Email</a>
        </li>
        <li>
          <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On GitHub ">GitHub</a>
        </li>
        <li>
          <a href="https://feeds.feedburner.com/TechTinkering" title="Subscribe to our RSS Feed">RSS</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div id="content" class="container">
      <div class="margin-buffer">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <a href="/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/" title="How to share an SSL certificate and still use cookies">
          <h1 itemprop="headline name">How to share an SSL certificate and still use cookies</h1>
        </a>
        <div>
            <time itemprop="datePublished"
                  datetime="2008-09-16">
              16 September 2008
            </time>
          <span itemscope itemprop="publisher"
                itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="TechTinkering" />
            <meta itemprop="url" content="https://techtinkering.com" />
          </span>
          <span itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a rel="author" itemprop="url" href="https://lawrencewoodman.github.io">
              <span itemprop="name">Lawrence Woodman</span>
            </a>
          </span>

          <ul class="tags">
              <li>#<a href="/articles/tag/php/">PHP</a></li>
              <li>#<a href="/articles/tag/programming/">Programming</a></li>
              <li>#<a href="/articles/tag/ssl/">SSL</a></li>
              <li>#<a href="/articles/tag/security/">Security</a></li>
              <li>#<a href="/articles/tag/webdevelopment/">Web Development</a></li>
          </ul>
        </div>
      </header>
        <div itemprop="articleBody">
        <p>Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses cookies.  I have read many people say that this can't be done.  However, this article will show a simple way of using a shared SSL certificate with cookies for a login page.</p>
<h2>Explanation of the problem</h2>
<p>When the data is entered into the login form it is passed to a script handling it on a secure server.  The secure server will be using a different session from the one connected with the login page because the session cookie is associated with a specific server.  Therefore when you change a session variable to reflect that the user has logged in successfully you will find that this has only changed the variable for the session on the secure server.  When you return to the insecure part of the site you will be returning to the original session, so you won't be able to see any changes made to reflect the success of the login.</p>
<h2>The method</h2>
<p>In order to update the session variables to reflect the success of the login and for them to be seen by the insecure session we need to pass the insecure session ID to the secure session.</p>
<p>In the login page you need the following PHP to record the session ID.</p>
<pre><code class="language-PHP">&lt;?php
session_start();

//------------------------------------------------
// Record the session id so that it can be passed
// and used in the secure session
//------------------------------------------------
if( SID == &quot;&quot; )
  $insecureSID = $_REQUEST[PHPSESSID];
else
  $insecureSID = session_id();
?&gt;
</code></pre>
<p>Then you need to pass this session ID to the PHP script handling the form on the secure server.  You will need to ask your hosting company for the url of the secure server and replace it in the code below.  The code snippet also checks which server is being accessed.  This is so that you can test the rest of the functionality without using SSL certificates.</p>
<pre><code class="language-PHP">&lt;?php
// Put the address of your test server here
$testServer = &quot;127.0.0.1&quot;;
// Put the address of your secure server here and the root of the website
$secureServerPrefix = &quot;https://secure.server.net/~myaccount/mywebsite.com&quot;;

// If not logged into test server
if( $_SERVER[SERVER_ADDR] != $testServer )
  $serverPrefix = $secureServerPrefix;

$htmlOutput .= &quot;&lt;form method=\&quot;post\&quot; action=\&quot;&quot;.$serverPrefix/login.handler.php.&quot;\&quot;&gt;&quot;;

$htmlOutput .= &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;insecureSID\&quot; value=\&quot;&quot;.$insecureSID.&quot;\&quot;&gt;&quot;;
?&gt;
</code></pre>
<p>The next piece of PHP code is located near the beginning of <code>login.handler.php</code>, which handles the form above.  It again tests to see if this is being run on a test server without a shared SSL certificate.  The code sets the current session ID to that of the insecure session.  This does not make the passing of the details from the form insecure, it just means that we can access the insecure session's variables.</p>
<p>Then the <code>$webPrefix</code> and <code>$_SERVER[DOCUMENT_ROOT]</code> variables are set so that if we need to <code>include</code> a file, or if we need to use <code>header</code>, the correct location will be referred to.</p>
<pre><code class="language-PHP">&lt;?php
// Put the address of your test server here
$testServer = &quot;127.0.0.1&quot;;

// If not logged into the test server
if( $_SERVER[SERVER_ADDR] != $testServer ) {

  // Use the normal connection session not the secure server session
  if( isset($_POST[insecureSID]) ){
    session_id($_POST[insecureSID]);
  }

  //--------------------------------------
  // Point everything to the right places
  //--------------------------------------

  // Set this to the address of your website
  $webPrefix = &quot;http://mywebsite.com&quot;;

  // Set this the location on hosting companies server where your website resides
  $_SERVER[DOCUMENT_ROOT] = &quot;/home/myaccount/www/mywebsite.com&quot;;
}

session_start();
?&gt;
</code></pre>
<p>Once the script has determined if it is a successful login, the appropriate session variables can be set and we can then return to the insecure server using the <code>$webPrefix</code> variable:</p>
<pre><code class="language-PHP">header(&quot;Location: &quot;.$webPrefix.&quot;/loggedInPage.html&quot;);
</code></pre>
<h2>Further enhancement</h2>
<p>To increase the security of this method you could also check that the referrer is as you expect using <code>$_SERVER[HTTP_REFERER]</code>.  This is not foolproof as it can be faked, but it is useful to reduce the likelihood of low-level attacks.</p>
      </div>
    </article>
</div>

  <div id="cclicence">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">How to share an SSL certificate and still use cookies</span>
    by <a xmlns:cc="http://creativecommons.org/ns#" href="https://techtinkering.com/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/" property="cc:attributionName" rel="cc:attributionURL">Lawrence Woodman</a>
   is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
   
  </div>


  <div class="discuss">
    <h2 style="margin-top:0;">Share This Post</h2>
    <div class="contact">
  <ul>
    <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Ftechtinkering.com%2F2008%2F09%2F16%2Fhow-to-share-an-ssl-certificate-and-still-use-cookies%2F&title=How%20to%20share%20an%20SSL%20certificate%20and%20still%20use%20cookies" target="_blank" title="Submit to Reddit">Reddit</a></li>
    <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftechtinkering.com%2F2008%2F09%2F16%2Fhow-to-share-an-ssl-certificate-and-still-use-cookies%2F&quote=How%20to%20share%20an%20SSL%20certificate%20and%20still%20use%20cookies" target="_blank" title="Share on Facebook">Facebook</a></li>
    <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Ftechtinkering.com%2F2008%2F09%2F16%2Fhow-to-share-an-ssl-certificate-and-still-use-cookies%2F&text=How%20to%20share%20an%20SSL%20certificate%20and%20still%20use%20cookies:%0Ahttps%3A%2F%2Ftechtinkering.com%2F2008%2F09%2F16%2Fhow-to-share-an-ssl-certificate-and-still-use-cookies%2F&via=TechTinkering" target="_blank" title="Tweet">Twitter</a></li>
    <li><a href="mailto:?subject=How%20to%20share%20an%20SSL%20certificate%20and%20still%20use%20cookies&body=Website%20hosting%20companies%20often%20provide%20a%20shared%20SSL%20certificate%2C%20but%20this%20presents%20the%20web%20designer%20with%20the%20problem%20of%20how%20to%20use%20it%20for%20a%20site%20that%20uses%20cookies.%20%20I%20have%20read%20many%20people%20say%20that%20th...:%0A%0Ahttps%3A%2F%2Ftechtinkering.com%2F2008%2F09%2F16%2Fhow-to-share-an-ssl-certificate-and-still-use-cookies%2F" target="_blank" title="Send email">Email</a></li>
  </ul>
</div>

    <h2>Feedback/Discuss</h2>
    <div class="contact">
  <ul>


    <li><a href="mailto:techtinkering@vlifesystems.com?subject=Comment:%20How%20to%20share%20an%20SSL%20certificate%20and%20still%20use%20cookies&body=Article%20URL:%20https%3A%2F%2Ftechtinkering.com%2F2008%2F09%2F16%2Fhow-to-share-an-ssl-certificate-and-still-use-cookies%2F%0A" title="Send us an email">Email</a></li>
  </ul>
</div>
  </div>

  <div id="email-subscribe">
  <form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=TechTinkering', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
    <p>Sign up to get new articles straight to your inbox.</p>
    <p><input type="text" style="width:180px" name="email" placeholder="Email address"/>
    <input type="hidden" value="TechTinkering" name="uri"/>
    <input type="hidden" name="loc" value="en_US"/>
    <input class="subscribe-button" type="submit" value="Subscribe" /></p>
    <p>Delivered by <a href="https://feedburner.google.com" target="_blank">FeedBurner</a></p>
  </form>
</div>


    <div>
    <h2>Related Articles</h2>
    <div class="margin-buffer">
      <header>
  <h2><a href="/articles/the-pilot-programming-language-on-cpm/">The Pilot Programming Language on CP/M</a></h2>
  <span class="post-meta">
      <time datetime="2020-10-22">
        22 October 2020
      </time>
    <ul class="tags">
      <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
      <li>#<a href="/articles/tag/programming/">Programming</a></li>
      <li>#<a href="/articles/tag/retro/">Retro</a></li>
    </ul>
  </span>
</header>
<div>
  Pilot was created by John A. Starkweather in the early 1960s as a programming language for Computer Assisted Instruction.  It has often been compared to Logo because of its use with children.  However,...
  &nbsp;
  <a class="readMore" href="/articles/the-pilot-programming-language-on-cpm/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/subleq-on-the-commodore-vic-20/">SUBLEQ on the Commodore VIC-20</a></h2>
  <span class="post-meta">
      <time datetime="2020-07-09">
         9 July 2020
      </time>
    <ul class="tags">
      <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
      <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
      <li>#<a href="/articles/tag/oisc/">OISC</a></li>
      <li>#<a href="/articles/tag/programming/">Programming</a></li>
      <li>#<a href="/articles/tag/retro/">Retro</a></li>
      <li>#<a href="/articles/tag/subleq/">SUBLEQ</a></li>
      <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
    </ul>
  </span>
</header>
<div>
  I have created a SUBLEQ Virtual Machine for the Commodore VIC-20.  SUBLEQ is a computer architecture that has only one instruction: SUBLEQ.  The instruction stands for SUbtract and Branch if Less than ...
  &nbsp;
  <a class="readMore" href="/articles/subleq-on-the-commodore-vic-20/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/subleq-a-one-instruction-set-computer/">SUBLEQ - A One Instruction Set Computer (OISC)</a></h2>
  <span class="post-meta">
      <time datetime="2020-05-29">
        29 May 2020
      </time>
    <ul class="tags">
      <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
      <li>#<a href="/articles/tag/oisc/">OISC</a></li>
      <li>#<a href="/articles/tag/programming/">Programming</a></li>
      <li>#<a href="/articles/tag/subleq/">SUBLEQ</a></li>
    </ul>
  </span>
</header>
<div>
  SUBLEQ has to be one of the easiest architectures to implement in either software or hardware and this is the main reason for its design as a teaching aid.  It has only one instruction, hence why it is...
  &nbsp;
  <a class="readMore" href="/articles/subleq-a-one-instruction-set-computer/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/the-mouse-programming-language-on-cpm/">The Mouse Programming Language on CP/M</a></h2>
  <span class="post-meta">
      <time datetime="2020-03-11">
        11 March 2020
      </time>
    <ul class="tags">
      <li>#<a href="/articles/tag/cpm/">CP/M</a></li>
      <li>#<a href="/articles/tag/programming/">Programming</a></li>
      <li>#<a href="/articles/tag/retro/">Retro</a></li>
    </ul>
  </span>
</header>
<div>
  Mouse is an interpreted stack orientated language designed by Peter Grogono around 1975.  It was designed to be a small but powerful language for microcomputers, similar to Forth, but much simpler.  On...
  &nbsp;
  <a class="readMore" href="/articles/the-mouse-programming-language-on-cpm/">Read More</a>
</div>
<br />
      <header>
  <h2><a href="/articles/sweet-16-the-6502-dream-machine-ported-to-the-vic-20/">Sweet 16 (The 6502 Dream Machine) Ported to the VIC-20</a></h2>
  <span class="post-meta">
      <time datetime="2020-02-29">
        29 February 2020
      </time>
    <ul class="tags">
      <li>#<a href="/articles/tag/assembly/">Assembly</a></li>
      <li>#<a href="/articles/tag/commodore/">Commodore</a></li>
      <li>#<a href="/articles/tag/programming/">Programming</a></li>
      <li>#<a href="/articles/tag/retro/">Retro</a></li>
      <li>#<a href="/articles/tag/vic-20/">VIC-20</a></li>
    </ul>
  </span>
</header>
<div>
  Sweet 16 was created by Steve Wozniak to reduce code size and make it easier to handle 16-bit pointers and arithmetic for his Apple Integer BASIC.  He wrote it around 1977 and referred to it in an arti...
  &nbsp;
  <a class="readMore" href="/articles/sweet-16-the-6502-dream-machine-ported-to-the-vic-20/">Read More</a>
</div>
<br />
</div>
    </div>

    </div>

    <footer>
  <nav>
    <div class="container">
      <div>
        <strong>Legal:</strong>
        <a href="/terms/">T & C</a>, <a href="/privacy/">Privacy Policy</a>
      </div>
    </div>
  </nav>
</footer>
  </body>
</html>