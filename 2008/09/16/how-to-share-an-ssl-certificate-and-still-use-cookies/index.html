<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>How to share an SSL certificate and still use cookies</title>

  <title>How to share an SSL certificate and still use cookies</title>
  <meta name="description" content="Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses c...">

  <meta name="keywords" content="Retro Vintage Programming Tinkering"/>

  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/sitestyle.css" rel="stylesheet">
  <link href="/css/html_pygments.css" rel="stylesheet">

  <link rel="canonical" href="/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/">
  <link rel="alternate" type="application/rss+xml" title="Techtinkering RSS Feed" href="http://feedproxy.google.com/TechTinkering" />

  <!-- Fix for ie 5&6 where id doesnt render transparent images properly-->
  <!--[if lte IE 6]>
    <script defer type="text/javascript" src="/js/pngfix.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/js/html5shiv.3.7.2.min.js"></script>
    <script src="/js/respond.1.4.2.min.js"></script>
  <![endif]-->

  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=vlifesystems"></script>

  <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
  <script type="text/javascript">
      window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":"/tandc/#privacy","theme":"dark-bottom"};
  </script>

  <script type="text/javascript" src="//s3.amazonaws.com/cc.silktide.com/cookieconsent.latest.min.js"></script>
  <!-- End Cookie Consent plugin -->
</head>


  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">TechTinkering</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li
        
        ><a href="/">Home</a></li>

        <li
        
        ><a href="/archive">Archive</a></li>

        

        

        

        

        

        <li
        
        ><a href="/about">About</a></li>
      </ul>

      <a href="http://feedproxy.google.com/TechTinkering" title="Subscribe to TechTinkering's RSS Feed">
        <img class="bannerIcon" src="/images/feed-icon-28x28.png" alt="RSS Feed"/>
      </a>

      <!-- From: http://www.buttonshut.com/Get-Button-Huts-Code/Youtube-Buttons-831.html -->
      <a href="http://youtube.com/techtinkering" title="TechTinkering's YouTube Channel">
        <img class="bannerIcon" src="/images/youtube-small-square-32.png" alt="YouTube Channel"/>
      </a>

      <!-- From: http://www.buttonshut.com/Get-Button-Huts-Code/Twitter-Buttons-1124.html -->
      <a href="http://twitter.com/TechTinkering" title="@TechTinkering on Twitter">
        <img class="bannerIcon" src="/images/twitter-button-36.png" alt="@techtinkering on Twitter"/>
      </a>


      <!-- From: http://www.graphicsfuel.com/2011/05/email-icon-psd/ -->
      <a href="mailto:techtinkering@vlifesystems.com" title="Email us, we'd love to hear from you">
        <img class="bannerIcon" src="/images/email.png" alt="Email"/>
      </a>

      <a href="https://github.com/lawrencewoodman/techtinkering.com" title="Fork TechTinkering On Github ">
        <img class="bannerIcon" src="/images/octocat_fluid.png" alt="Techtinkering Repo on  Github"/>
      </a>

    </div><!--/.nav-collapse -->
  </div>

</nav>


    <div id="content" class="container">
      <div class="row">
  <div class="col-md-8">
    <article itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 itemprop="name"><a href="/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/" title="How to share an SSL certificate and still use cookies">How to share an SSL certificate and still use cookies</a></h1>
    <span class="byLine">
      by <span itemscope itemprop="author" itemtype="http://schema.org/Person">
           <a rel="author" itemprop="url" class="author" href="/profile/lawrencewoodman/">
             <span itemprop="name">Lawrence Woodman</span>
           </a>
         </span>
      <time itemprop="datePublished" datetime="2008-09-16">
        16 September 2008
      </time>
    </span>


    <!-- AddThis Button BEGIN -->
    <div style="float: right;" class="addthis_toolbox addthis_default_style addthis_32x32_style">
    <a class="addthis_button_google_plusone" g:plusone:count="false"></a>
    <a class="addthis_button_facebook"></a>
    <a class="addthis_button_twitter"></a>
    <a class="addthis_button_reddit"></a>
    <a class="addthis_button_compact"></a>
    </div>
    <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=vlifesystems"></script>
    <!-- AddThis Button END -->

    <span class="tagLine">
      <br />
      Tags:
      
        <a rel="tag" href="/tag/php">PHP</a> &nbsp; &nbsp;
      
        <a rel="tag" href="/tag/programming">Programming</a> &nbsp; &nbsp;
      
        <a rel="tag" href="/tag/security">Security</a> &nbsp; &nbsp;
      
        <a rel="tag" href="/tag/ssl">SSL</a> &nbsp; &nbsp;
      
        <a rel="tag" href="/tag/webdevelopment">Web Development</a> &nbsp; &nbsp;
      
    </span>

  </header>

  <div class="articleBody" itemprop="articleBody">
    <p>Website hosting companies often provide a shared SSL certificate, but this presents the web designer with the problem of how to use it for a site that uses cookies.  I have read many people say that this can’t be done.  However, this article will show a simple way of using a shared SSL certificate with cookies for a login page.</p>

<h2 id="explanation-of-the-problem">Explanation of the problem</h2>
<p>When the data is entered into the login form it is passed to a script handling it on a secure server.  The secure server will be using a different session from the one connected with the login page because the session cookie is associated with a specific server.  Therefore when you change a session variable to reflect that the user has logged in successfully you will find that this has only changed the variable for the session on the secure server.  When you return to the insecure part of the site you will be returning to the original session, so you won’t be able to see any changes made to reflect the success of the login.</p>

<h2 id="the-method">The method</h2>
<p>In order to update the session variables to reflect the success of the login and for them to be seen by the insecure session we need to pass the insecure session ID to the secure session.</p>

<p>In the login page you need the following PHP to record the session ID.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">session_start</span><span class="p">();</span>

<span class="c1">//------------------------------------------------
// Record the session id so that it can be passed
// and used in the secure session
//------------------------------------------------
</span><span class="k">if</span><span class="p">(</span> <span class="nx">SID</span> <span class="o">==</span> <span class="s2">""</span> <span class="p">)</span>
  <span class="nv">$insecureSID</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="nx">PHPSESSID</span><span class="p">];</span>
<span class="k">else</span>
  <span class="nv">$insecureSID</span> <span class="o">=</span> <span class="nb">session_id</span><span class="p">();</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Then you need to pass this session ID to the PHP script handling the form on the secure server.  You will need to ask your hosting company for the url of the secure server and replace it in the code below.  The code snippet also checks which server is being accessed.  This is so that you can test the rest of the functionality without using SSL certificates.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// Put the address of your test server here
</span><span class="nv">$testServer</span> <span class="o">=</span> <span class="s2">"127.0.0.1"</span><span class="p">;</span>
<span class="c1">// Put the address of your secure server here and the root of the website
</span><span class="nv">$secureServerPrefix</span> <span class="o">=</span> <span class="s2">"https://secure.server.net/~myaccount/mywebsite.com"</span><span class="p">;</span>

<span class="c1">// If not logged into test server
</span><span class="k">if</span><span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="nx">SERVER_ADDR</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$testServer</span> <span class="p">)</span>  
  <span class="nv">$serverPrefix</span> <span class="o">=</span> <span class="nv">$secureServerPrefix</span><span class="p">;</span>

<span class="nv">$htmlOutput</span> <span class="o">.=</span> <span class="s2">"&lt;form method=</span><span class="se">\"</span><span class="s2">post</span><span class="se">\"</span><span class="s2"> action=</span><span class="se">\"</span><span class="s2">"</span><span class="o">.</span><span class="nv">$serverPrefix</span><span class="o">/</span><span class="nx">login</span><span class="o">.</span><span class="nx">handler</span><span class="o">.</span><span class="nx">php</span><span class="o">.</span><span class="s2">"</span><span class="se">\"</span><span class="s2">&gt;"</span><span class="p">;</span>

<span class="nv">$htmlOutput</span> <span class="o">.=</span> <span class="s2">"&lt;input type=</span><span class="se">\"</span><span class="s2">hidden</span><span class="se">\"</span><span class="s2"> name=</span><span class="se">\"</span><span class="s2">insecureSID</span><span class="se">\"</span><span class="s2"> value=</span><span class="se">\"</span><span class="s2">"</span><span class="o">.</span><span class="nv">$insecureSID</span><span class="o">.</span><span class="s2">"</span><span class="se">\"</span><span class="s2">&gt;"</span><span class="p">;</span> 
<span class="cp">?&gt;</span></code></pre></figure>

<p>The next piece of PHP code is located near the beginning of <code class="highlighter-rouge">login.handler.php</code>, which handles the form above.  It again tests to see if this is being run on a test server without a shared SSL certificate.  The code sets the current session ID to that of the insecure session.  This does not make the passing of the details from the form insecure, it just means that we can access the insecure session’s variables.</p>

<p>Then the <code class="highlighter-rouge">$webPrefix</code> and <code class="highlighter-rouge">$_SERVER[DOCUMENT_ROOT]</code> variables are set so that if we need to <code class="highlighter-rouge">include</code> a file, or if we need to use <code class="highlighter-rouge">header</code>, the correct location will be referred to.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// Put the address of your test server here
</span><span class="nv">$testServer</span> <span class="o">=</span> <span class="s2">"127.0.0.1"</span><span class="p">;</span>  

<span class="c1">// If not logged into the test server
</span><span class="k">if</span><span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="nx">SERVER_ADDR</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$testServer</span> <span class="p">)</span> <span class="p">{</span>

  <span class="c1">// Use the normal connection session not the secure server session
</span>  <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nx">insecureSID</span><span class="p">])</span> <span class="p">){</span>
    <span class="nb">session_id</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="nx">insecureSID</span><span class="p">]);</span>
  <span class="p">}</span> 

  <span class="c1">//--------------------------------------
</span>  <span class="c1">// Point everything to the right places
</span>  <span class="c1">//--------------------------------------
</span>
  <span class="c1">// Set this to the address of your website
</span>  <span class="nv">$webPrefix</span> <span class="o">=</span> <span class="s2">"http://mywebsite.com"</span><span class="p">;</span>   

  <span class="c1">// Set this the location on hosting companies server where your website resides
</span>  <span class="nv">$_SERVER</span><span class="p">[</span><span class="nx">DOCUMENT_ROOT</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/home/myaccount/www/mywebsite.com"</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">session_start</span><span class="p">();</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Once the script has determined if it is a successful login, the appropriate session variables can be set and we can then return to the insecure server using the <code class="highlighter-rouge">$webPrefix</code> variable:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">header("Location: ".$webPrefix."/loggedInPage.html");</code></pre></figure>

<h2 id="further-enhancement">Further enhancement</h2>
<p>To increase the security of this method you could also check that the referrer is as you expect using <code class="highlighter-rouge">$_SERVER[HTTP_REFERER]</code>.  This is not foolproof as it can be faked, but it is useful to reduce the likelihood of low-level attacks.</p>

  </div>
</article>


    <div style="clear: left;"></div>

    
      <hr />
      <a rel="license" href="http://creativecommons.org/licenses/by/2.0/uk/">
        <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/2.0/uk/88x31.png" />
      </a>
      <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" property="dc:title" rel="dc:type">
        How to share an SSL certificate and still use cookies
      </span><br />

      by
      <a xmlns:cc="http://creativecommons.org/ns#" href="http://techtinkering.com/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/" property="cc:attributionName" rel="cc:attributionURL">
      TechTinkering
      </a>
       is licensed under a
      <a rel="license" href="http://creativecommons.org/licenses/by/2.0/uk/">
      Creative Commons Attribution 2.0 UK: England & Wales License
      </a>
    

    <hr style="clear:both;" />

    
      <h2>Related</h2>
      <ul class="briefPosts">
        
          <li><a href="/2011/08/17/improving-related-posts-on-jekyll/">Improving the related_posts feature of jekyll</a></li>
        
          <li><a href="/2011/02/15/a-jekyll-plugin-to-display-ratings-as-star-images/">A Jekyll Plugin to Display Ratings as Star Images</a></li>
        
          <li><a href="/2014/04/19/beware-of-immutable-lists-for-fsharp-parallel-processing/">Beware of Immutable Lists for F# Parallel Processing</a></li>
        
          <li><a href="/2013/05/10/adding-a-basic-stub-to-a-vic-20-assembly-language-program/">Adding a Basic Stub to a Vic-20 Assembly Language Program</a></li>
        
          <li><a href="/2013/05/04/creating-a-tty-simulator-in-assembly-language-on-the-vic-20/">Creating a TTY Simulator in Assembly Language on the Vic-20</a></li>
        
      </ul>
    

    <hr />

    <div id="rightAd">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-1613732348909658";
      /* 300x250 - TechTinkering */
      google_ad_slot = "8883223823";
      google_ad_width = 300;
      google_ad_height = 250;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <h2>Bookmark and Share</h2>
    <a href="http://feedproxy.google.com/TechTinkering" title="Subscribe to TechTinkering's RSS Feed"><img class="bookmarkIcon" src="/images/feed-icon-28x28.png" alt="RSS Feed"/>
    </a> Subscribe to RSS feed<br />

    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style addthis_32x32_style" style="left:50px;top:50px;">
      <a class="addthis_button_google_plusone" g:plusone:count="false"></a> &nbsp; Share on Google+<br />
      <br />
      <a class="addthis_button_facebook"></a> &nbsp; Share on Facebook<br />
      <br />
      <a class="addthis_button_twitter"></a> &nbsp; Share on Twitter<br />
      <br />
      <a class="addthis_button_reddit"></a> &nbsp; Share on Reddit<br />
      <br />
      <a class="addthis_button_compact"></a> &nbsp; Share elsewhere<br />
    </div>
    <!-- AddThis Button END -->

    <hr style="clear:both;" />

    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'techtinkering';
      var disqus_identifier = '/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/';
      var disqus_url = 'http://techtinkering.com/2008/09/16/how-to-share-an-ssl-certificate-and-still-use-cookies/';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>


  <div class="col-md-4">
    <div class="columnAd">
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-1613732348909658";
      /* 300x250 - TechTinkering */
      google_ad_slot = "8883223823";
      google_ad_width = 300;
      google_ad_height = 250;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>
    </div>

    <h2>Latest Articles</h2>
    <ul class="briefPosts">
      
        <li><a href="/2016/03/06/book-review-what-the-dormouse-said-by-john-markoff/">Book Review: What the Dormouse Said by John Markoff</a></li>
      
        <li><a href="/2014/06/22/how-to-make-thunderbird-feel-like-geary/">How to Make Thunderbird Feel Like Geary</a></li>
      
        <li><a href="/2014/04/19/beware-of-immutable-lists-for-fsharp-parallel-processing/">Beware of Immutable Lists for F# Parallel Processing</a></li>
      
        <li><a href="/2013/08/29/rendering-racket-package-scribblings-on-github-using-gh-pages/">Rendering Racket Package Scribblings on Github Using gh-pages</a></li>
      
        <li><a href="/2013/05/29/programmable-character-sets-a-simple-alternative-to-bitmap-displays/">Programmable Character Sets: A Simple Alternative to Bitmap Displays</a></li>
      
    </ul>

    <h2>Popular Tags</h2>
    <div>
      <a style='font-size: 70%' href='/tag/debugging'>Debugging</a>
<a style='font-size: 70%' href='/tag/xace'>xAce</a>
<a style='font-size: 70%' href='/tag/editors'>Editors</a>
<a style='font-size: 171%' href='/tag/tutorial'>Tutorial</a>
<a style='font-size: 88%' href='/tag/subleq'>SUBLEQ</a>
<a style='font-size: 100%' href='/tag/pdp-8'>PDP-8</a>
<a style='font-size: 100%' href='/tag/book'>Book</a>
<a style='font-size: 100%' href='/tag/dec'>DEC</a>
<a style='font-size: 88%' href='/tag/webdevelopment'>Web Development</a>
<a style='font-size: 110%' href='/tag/cpm'>CP/M</a>
<a style='font-size: 131%' href='/tag/emulation'>Emulation</a>
<a style='font-size: 88%' href='/tag/history'>History</a>
<a style='font-size: 70%' href='/tag/textmode'>Text mode</a>
<a style='font-size: 177%' href='/tag/programming'>Programming</a>
<a style='font-size: 88%' href='/tag/bbs'>BBS</a>
<a style='font-size: 70%' href='/tag/c'>C</a>
<a style='font-size: 70%' href='/tag/imsai'>IMSAI</a>
<a style='font-size: 88%' href='/tag/vic-20'>Vic-20</a>
<a style='font-size: 110%' href='/tag/review'>Review</a>
<a style='font-size: 70%' href='/tag/adventuregames'>Adventure Games</a>
<a style='font-size: 70%' href='/tag/computerarchitecure'>Computer Architecure</a>
<a style='font-size: 70%' href='/tag/jekyll'>Jekyll</a>
<a style='font-size: 100%' href='/tag/commodore'>Commodore</a>
<a style='font-size: 88%' href='/tag/dos'>DOS</a>
<a style='font-size: 70%' href='/tag/offtopic'>Off Topic</a>
<a style='font-size: 118%' href='/tag/assembly'>Assembly</a>
<a style='font-size: 118%' href='/tag/linux'>Linux</a>
<a style='font-size: 70%' href='/tag/parallelprocessing'>Parallel Processing</a>
<a style='font-size: 70%' href='/tag/webscraping'>Web Scraping</a>
<a style='font-size: 70%' href='/tag/z80'>Z80</a>
<a style='font-size: 100%' href='/tag/games'>Games</a>
<a style='font-size: 88%' href='/tag/tcltk'>Tcl/Tk</a>
<a style='font-size: 110%' href='/tag/ruby'>Ruby</a>
<a style='font-size: 70%' href='/tag/8080'>8080</a>
<a style='font-size: 88%' href='/tag/oisc'>OISC</a>
<a style='font-size: 70%' href='/tag/jupiterace'>Jupiter Ace</a>
<a style='font-size: 200%' href='/tag/retro'>Retro</a>

    </div>

  </div>
</div>

    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <strong>Legal:</strong> &nbsp;
        <a href="/tandc/">Terms</a>,
        <a href="/statinfo/">Statutory Information</a>

        &nbsp; &nbsp;
        <strong>RSS Feeds:</strong> &nbsp;
        <a href="http://feedproxy.google.com/TechTinkering" title="Subscribe to TechTinkering's RSS Feed">Full</a>,
        <a href="http://feeds.feedburner.com/Retro-Techtinkering" title="Subscribe to TechTinkering's Retro RSS Feed">Retro</a>
      </div>
    </div>
  </div>
</footer>




    <!-- Amazon Product Preview Code -->
    <script type="text/javascript" src="http://www.assoc-amazon.co.uk/s/link-enhancer?tag=techtinkering-21&amp;o=2">
    </script>
    <noscript>
        <img src="http://www.assoc-amazon.co.uk/s/noscript?tag=techtinkering-21" alt="" />
    </noscript>

    <!-- Google Analytics tracking code -->
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-4388762-2");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/bootstrap.min.js"></script>

  </body>
</html>
